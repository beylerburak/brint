# Refactor Plan
- **Routing ve locale doğruluğu (öncelik yüksek)**: Tüm App Router sayfa/layout’larında `params` tipini düz nesneye çek, `await params` kullanımını kaldır. Locale’li path üretimini tek yardımcıda topla (login/onboarding/home yönlendirmeleri dahil) ve tüm `router.push/replace` çağrılarını bu yardımcıyı kullanacak şekilde düzelt. Root/onboarding yönlendirmelerini RSC tarafında çözüp FOUC’u azalt.
- **Kimlik doğrulama ve middleware sertleştirmesi**: `middleware.ts` içinde imzası doğrulanmamış JWT payload kullanımını bırak; token geçerliliğini backend’e HEAD/ping ile doğrula veya imza kontrolü yapan hafif bir helper ekle. Onboarding/workspace erişim kontrolünü sunucu tarafına taşı ve locale duyarlı redirect’leri merkezi hale getir.
- **API katmanı modülerleştirme**: `lib/api-client.ts`’yi domain bazlı modüllere böl (auth, workspace, brand, content, tasks, integrations). Ortak `fetchJson` helper’ı oluştur, `baseURL`’yi tek noktadan (env + config) oku, `window.location` içeren yan etkileri kaldır. SSR’de tekrar kullanılabilir olması için cookie/header geçişini destekle.
- **Veri getirme stratejisi**: Kök `app/[locale]/page.tsx` ve workspace/brand layout’larını server component yap, `/me` ve workspace özetini SSR’da fetch edip client’a hydration datası olarak geçir. Client tarafı fetch’leri için React Query/SWR entegrasyonu ekleyip api cache yerine kullan; mevcut cache sınıfını kademeli kaldır.
- **Workspace context yeniden tasarımı**: `WorkspaceProvider`’ı sadece UI-level state için kullan; redirect’leri Router üstünden ve locale-aware yap; `/me` verisini server’dan besleyip boş alanları stub’lama. Slug/ID eşleşmesini doğrulayan bir selector ve hata/404 handling ekle.
- **Auth ve profil formları**: `components/login-form.tsx` ve settings profile sayfasını API client’a taşı, sabit host ve `sessionStorage` parola saklamayı kaldır. Form doğrulama ve hata mesajlarını `next-intl` ile çevirilere taşı; ortak auth service’e yönlendirme kuralı ekle.
- **Navigasyon ve izinler**: `features/workspace/workspace-nav-menu.tsx` ve brand nav menülerinde `url: "#"`) placeholder’larını kaldır; menüyü workspace rolü/plan verisine göre üreten bir kaynak dosyasına taşı. Pinned brand verisini server’dan doğrulayıp localStorage ile senkronize eden tek bir hook yaz.
- **İçerik oluşturma ve görev modülleri**: `ContentCreationModal` ve `tasks/page.tsx` gibi büyük bileşenleri veri/yan etki/ UI alt bileşenlerine ayır; upload/tag/search/publish API çağrılarını custom hooks + React Query ile yönet; WebSocket URL üretimini `wss` destekleyecek yardımcıya taşı.
- **Konfigürasyon ve i18n kapsaması**: API host, app adı, destek e-postası gibi tüm sabitleri `config/app-config.ts` + env üzerinden oku; default/fallback host’u kaldır. Hardcoded metinleri çeviri dosyalarına taşı, eksik `tr` anahtarlarını doldur, nav/settings/login/onboarding kopyalarını anahtar bazlı hale getir.
- **Gözlemlenebilirlik ve testler**: API client ve yönlendirme yardımcıları için birim testleri; auth/onboarding/middleware akışları için e2e testleri ekle. WebSocket bağlantı/süreklilik metrikleri ve hata log’ları için merkezi logging (console yerine) tanımla.
